var _ = {}, za = {
    para: {
        name: "sensors",
        server_url: "",
        send_timeout: 1e3,
        use_client_time: !1,
        show_log: !0,
        launched: !1,
        allow_amend_share_path: !0,
        max_string_length: 300,
        datasend_timeout: 3e3,
        source_channel: [],
        autoTrack: {appLaunch: !0, appShow: !0, appHide: !0, pageShow: !0, pageShare: !0, mpClick: !1, mpFavorite: !0},
        autotrack_exclude_page: {pageShow: []},
        is_persistent_save: {share: !1, utm: !1},
        preset_properties: {}
    }
}, mpHook = {
    data: 1,
    onLoad: 1,
    onShow: 1,
    onReady: 1,
    onPullDownRefresh: 1,
    onReachBottom: 1,
    onShareAppMessage: 1,
    onPageScroll: 1,
    onResize: 1,
    onTabItemTap: 1,
    onHide: 1,
    onUnload: 1
}, logger = "object" == typeof logger ? logger : {};
logger.info = function () {
    if (za.para.show_log && "object" == typeof console && console.log) try {
        if (3 === arguments.length) return console.log(arguments[0], arguments[1], arguments[2]);
        if (2 === arguments.length) return console.log(arguments[0], arguments[1]);
        if (1 === arguments.length) return console.log(arguments[0])
    } catch (e) {
        console.log(arguments[0])
    }
}, za.setPara = function (e) {
    za.para = _.extend2Lev(za.para, e);
    var t = [];
    if (_.isArray(za.para.source_channel)) for (var a = za.para.source_channel.length, r = 0; r < a; r++) -1 === " utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" " + za.para.source_channel[r] + " ") && t.push(za.para.source_channel[r]);
    za.para.source_channel = t, _.isObject(za.para.register) && _.extend(_.info.properties, za.para.register), za.para.openid_url || (za.para.openid_url = za.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/, "$1/mp_login")), "number" != typeof za.para.send_timeout && (za.para.send_timeout = 1e3);
    var s = {send_timeout: 6e3, max_length: 6};
    e && e.datasend_timeout || za.para.batch_send && (za.para.datasend_timeout = 1e4), !0 === za.para.batch_send ? (za.para.batch_send = _.extend({}, s), za.para.use_client_time = !0) : _.isObject(za.para.batch_send) && (za.para.use_client_time = !0, za.para.batch_send = _.extend({}, s, za.para.batch_send));
    var n = {share: !1, utm: !1};
    !0 === za.para.is_persistent_save ? (za.para.is_persistent_save = _.extend({}, n), za.para.is_persistent_save.utm = !0) : _.isObject(za.para.is_persistent_save) && (za.para.is_persistent_save = _.extend({}, n, za.para.is_persistent_save)), za.para.server_url ? za.para.preset_properties = _.isObject(za.para.preset_properties) ? za.para.preset_properties : {} : logger.info("\u8bf7\u4f7f\u7528 setPara() \u65b9\u6cd5\u8bbe\u7f6e server_url \u6570\u636e\u63a5\u6536\u5730\u5740,\u8be6\u60c5\u53ef\u67e5\u770bhttps://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0")
}, za.status = {};
var ArrayProto = Array.prototype, FuncProto = Function.prototype, ObjProto = Object.prototype, slice = ArrayProto.slice,
    toString = ObjProto.toString, hasOwnProperty = ObjProto.hasOwnProperty, LIB_VERSION = "1.14.5",
    LIB_NAME = "MiniProgram", source_channel_standard = "utm_source utm_medium utm_campaign utm_content utm_term",
    latest_source_channel = ["$latest_utm_source", "$latest_utm_medium", "$latest_utm_campaign", "$latest_utm_content", "$latest_utm_term", "$latest_sa_utm"],
    latest_share_info = ["$latest_share_distinct_id", "$latest_share_url_path", "$latest_share_depth", "$latest_share_method"],
    sa_referrer = "\u76f4\u63a5\u6253\u5f00";
za.status.referrer = "\u76f4\u63a5\u6253\u5f00";
var mpshow_time = null, query_share_depth = 0, share_distinct_id = "", share_method = "", current_scene = "",
    is_first_launch = !1;
za.lib_version = LIB_VERSION;
var globalTitle = {};
!function () {
    FuncProto.bind;
    var e = ArrayProto.forEach, t = ArrayProto.indexOf, a = Array.isArray, r = {}, s = _.each = function (t, a, s) {
        if (null == t) return !1;
        if (e && t.forEach === e) t.forEach(a, s); else if (t.length === +t.length) {
            for (var n = 0, i = t.length; n < i; n++) if (n in t && a.call(s, t[n], n, t) === r) return !1
        } else for (var o in t) if (hasOwnProperty.call(t, o) && a.call(s, t[o], o, t) === r) return !1
    };
    _.logger = logger, _.extend = function (e) {
        return s(slice.call(arguments, 1), function (t) {
            for (var a in t) void 0 !== t[a] && (e[a] = t[a])
        }), e
    }, _.extend2Lev = function (e) {
        return s(slice.call(arguments, 1), function (t) {
            for (var a in t) void 0 !== t[a] && null !== t[a] && (_.isObject(t[a]) && _.isObject(e[a]) ? _.extend(e[a], t[a]) : e[a] = t[a])
        }), e
    }, _.coverExtend = function (e) {
        return s(slice.call(arguments, 1), function (t) {
            for (var a in t) void 0 !== t[a] && void 0 === e[a] && (e[a] = t[a])
        }), e
    }, _.isArray = a || function (e) {
        return "[object Array]" === toString.call(e)
    }, _.isFunction = function (e) {
        try {
            return /^\s*\bfunction\b/.test(e)
        } catch (e) {
            return !1
        }
    }, _.isArguments = function (e) {
        return !(!e || !hasOwnProperty.call(e, "callee"))
    }, _.toArray = function (e) {
        return e ? e.toArray ? e.toArray() : _.isArray(e) ? slice.call(e) : _.isArguments(e) ? slice.call(e) : _.values(e) : []
    }, _.values = function (e) {
        var t = [];
        return null == e ? t : (s(e, function (e) {
            t[t.length] = e
        }), t)
    }, _.include = function (e, a) {
        var n = !1;
        return null == e ? n : t && e.indexOf === t ? -1 != e.indexOf(a) : (s(e, function (e) {
            if (n || (n = e === a)) return r
        }), n)
    }
}(), _.trim = function (e) {
    return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "")
}, _.isObject = function (e) {
    return null != e && "[object Object]" == toString.call(e)
}, _.isEmptyObject = function (e) {
    if (_.isObject(e)) {
        for (var t in e) if (hasOwnProperty.call(e, t)) return !1;
        return !0
    }
    return !1
}, _.isUndefined = function (e) {
    return void 0 === e
}, _.isString = function (e) {
    return "[object String]" == toString.call(e)
}, _.isDate = function (e) {
    return "[object Date]" == toString.call(e)
}, _.isBoolean = function (e) {
    return "[object Boolean]" == toString.call(e)
}, _.isNumber = function (e) {
    return "[object Number]" == toString.call(e) && /[\d\.]+/.test(String(e))
}, _.isJSONString = function (e) {
    try {
        JSON.parse(e)
    } catch (e) {
        return !1
    }
    return !0
}, _.decodeURIComponent = function (e) {
    var t = "";
    try {
        t = decodeURIComponent(e)
    } catch (a) {
        t = e
    }
    return t
}, _.encodeDates = function (e) {
    return _.each(e, function (t, a) {
        _.isDate(t) ? e[a] = _.formatDate(t) : _.isObject(t) && (e[a] = _.encodeDates(t))
    }), e
}, _.formatDate = function (e) {
    function t(e) {
        return e < 10 ? "0" + e : e
    }

    return e.getFullYear() + "-" + t(e.getMonth() + 1) + "-" + t(e.getDate()) + " " + t(e.getHours()) + ":" + t(e.getMinutes()) + ":" + t(e.getSeconds()) + "." + t(e.getMilliseconds())
}, _.searchObjDate = function (e) {
    _.isObject(e) && _.each(e, function (t, a) {
        _.isObject(t) ? _.searchObjDate(e[a]) : _.isDate(t) && (e[a] = _.formatDate(t))
    })
}, _.formatString = function (e) {
    return e.length > za.para.max_string_length ? (logger.info("\u5b57\u7b26\u4e32\u957f\u5ea6\u8d85\u8fc7\u9650\u5236\uff0c\u5df2\u7ecf\u505a\u622a\u53d6--" + e), e.slice(0, za.para.max_string_length)) : e
}, _.searchObjString = function (e) {
    _.isObject(e) && _.each(e, function (t, a) {
        _.isObject(t) ? _.searchObjString(e[a]) : _.isString(t) && (e[a] = _.formatString(t))
    })
}, _.parseSuperProperties = function (e) {
    _.isObject(e) && (_.each(e, function (t, a) {
        if (_.isFunction(t)) try {
            e[a] = t(), _.isFunction(e[a]) && (logger.info("\u60a8\u7684\u5c5e\u6027- " + a + " \u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664"), delete e[a])
        } catch (t) {
            delete e[a], logger.info("\u60a8\u7684\u5c5e\u6027- " + a + " \u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664")
        }
    }), _.strip_sa_properties(e))
}, _.unique = function (e) {
    for (var t, a = [], r = {}, s = 0; s < e.length; s++) (t = e[s]) in r || (r[t] = !0, a.push(t));
    return a
}, _.strip_sa_properties = function (e) {
    return _.isObject(e) ? (_.each(e, function (t, a) {
        if (_.isArray(t)) {
            var r = [];
            _.each(t, function (e) {
                _.isString(e) ? r.push(e) : logger.info("\u60a8\u7684\u6570\u636e-", t, "\u7684\u6570\u7ec4\u91cc\u7684\u503c\u5fc5\u987b\u662f\u5b57\u7b26\u4e32,\u5df2\u7ecf\u5c06\u5176\u5220\u9664")
            }), 0 !== r.length ? e[a] = r : (delete e[a], logger.info("\u5df2\u7ecf\u5220\u9664\u7a7a\u7684\u6570\u7ec4"))
        }
        _.isString(t) || _.isNumber(t) || _.isDate(t) || _.isBoolean(t) || _.isArray(t) || (logger.info("\u60a8\u7684\u6570\u636e-", t, "-\u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664"), delete e[a])
    }), e) : e
}, _.strip_empty_properties = function (e) {
    var t = {};
    return _.each(e, function (e, a) {
        null != e && (t[a] = e)
    }), t
}, _.utf8Encode = function (e) {
    var t, a, r, s, n = "";
    for (t = a = 0, r = (e = (e + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n")).length, s = 0; s < r; s++) {
        var i = e.charCodeAt(s), o = null;
        i < 128 ? a++ : o = i > 127 && i < 2048 ? String.fromCharCode(i >> 6 | 192, 63 & i | 128) : String.fromCharCode(i >> 12 | 224, i >> 6 & 63 | 128, 63 & i | 128), null !== o && (a > t && (n += e.substring(t, a)), n += o, t = a = s + 1)
    }
    return a > t && (n += e.substring(t, e.length)), n
}, _.base64Encode = function (e) {
    var t, a, r, s, n, i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", o = 0, c = 0, u = "",
        p = [];
    if (!e) return e;
    e = _.utf8Encode(e);
    do {
        t = (n = e.charCodeAt(o++) << 16 | e.charCodeAt(o++) << 8 | e.charCodeAt(o++)) >> 18 & 63, a = n >> 12 & 63, r = n >> 6 & 63, s = 63 & n, p[c++] = i.charAt(t) + i.charAt(a) + i.charAt(r) + i.charAt(s)
    } while (o < e.length);
    switch (u = p.join(""), e.length % 3) {
        case 1:
            u = u.slice(0, -2) + "==";
            break;
        case 2:
            u = u.slice(0, -1) + "="
    }
    return u
}, _.getCurrentPath = function () {
    var e = "\u672a\u53d6\u5230";
    try {
        var t = getCurrentPages();
        e = t[t.length - 1].route
    } catch (e) {
        logger.info(e)
    }
    return e
}, _.getIsFirstDay = function () {
    return "object" == typeof za.store._state && "number" == typeof za.store._state.first_visit_day_time && za.store._state.first_visit_day_time > (new Date).getTime()
}, _.getCurrentUrl = function (e) {
    var t = _.getCurrentPath(), a = "";
    return _.isObject(e) && e.sensors_mp_encode_url_query && (a = e.sensors_mp_encode_url_query), t ? a ? t + "?" + a : t : "\u672a\u53d6\u5230"
}, _.getPath = function (e) {
    return e = "string" == typeof e ? e.replace(/^\//, "") : "\u53d6\u503c\u5f02\u5e38"
}, _.getMethods = function (e) {
    var t = [];
    for (var a in e) "function" != typeof e[a] || mpHook[a] || t.push(a);
    return t
}, _.isClick = function (e) {
    return !!{tap: 1, longpress: 1, longtap: 1}[e]
}, za.initialState = {
    queue: [],
    isComplete: !1,
    systemIsComplete: !1,
    storeIsComplete: !1,
    checkIsComplete: function () {
        this.systemIsComplete && this.storeIsComplete && (this.isComplete = !0, this.queue.length > 0 && (_.each(this.queue, function (e) {
            za[e[0]].apply(za, slice.call(e[1]))
        }), this.queue = []))
    }
}, _.getCustomUtmFromQuery = function (e, t, a, r) {
    if (!_.isObject(e)) return {};
    var s = {};
    if (e.sa_utm) for (var n in e) "sa_utm" !== n ? _.include(za.para.source_channel, n) && (s[a + n] = e[n]) : s[r + n] = e[n]; else for (var n in e) -1 === (" " + source_channel_standard + " ").indexOf(" " + n + " ") ? _.include(za.para.source_channel, n) && (s[a + n] = e[n]) : s[t + n] = e[n];
    return s
}, _.getObjFromQuery = function (e) {
    var t = e.split("?"), a = [], r = {};
    return t && t[1] ? (_.each(t[1].split("&"), function (e) {
        (a = e.split("="))[0] && a[1] && (r[a[0]] = a[1])
    }), r) : {}
}, _.setStorageSync = function (e, t) {
    var a = function () {
        wx.setStorageSync(e, t)
    };
    try {
        a()
    } catch (e) {
        logger.info("set Storage fail --", e);
        try {
            a()
        } catch (e) {
            logger.info("set Storage fail again --", e)
        }
    }
}, _.getStorageSync = function (e) {
    var t = "";
    try {
        t = wx.getStorageSync(e)
    } catch (a) {
        try {
            t = wx.getStorageSync(e)
        } catch (e) {
            logger.info("getStorage fail")
        }
    }
    return t
}, _.getMPScene = function (e) {
    return "number" == typeof e || "string" == typeof e && "" !== e ? e = "wx-" + String(e) : "\u672a\u53d6\u5230\u503c"
}, _.setShareInfo = function (e, t) {
    var a = {}, r = {}, s = za.store.getDistinctId(), n = za.store.getFirstId();
    if (!(e && _.isObject(e.query) && e.query.sampshare)) return {};
    if (a = _.decodeURIComponent(e.query.sampshare), !_.isJSONString(a)) return {};
    var i = (a = JSON.parse(a)).d, o = a.p, c = a.i, u = a.m;
    "string" == typeof c ? (t.$share_distinct_id = c, share_distinct_id = c, r.$latest_share_distinct_id = c) : t.$share_distinct_id = "\u53d6\u503c\u5f02\u5e38", "number" == typeof i ? !share_distinct_id || share_distinct_id !== s && share_distinct_id !== n ? !share_distinct_id || share_distinct_id === s && share_distinct_id === n ? t.$share_depth = "-1" : (t.$share_depth = i + 1, query_share_depth = i + 1, r.$latest_share_depth = i + 1) : (t.$share_depth = i, query_share_depth = i, r.$latest_share_depth = i) : t.$share_depth = "-1", "string" == typeof o ? (t.$share_url_path = o, r.$latest_share_url_path = o) : t.$share_url_path = "\u53d6\u503c\u5f02\u5e38", "string" == typeof u ? (t.$share_method = u, r.$latest_share_method = u) : t.$share_method = "\u53d6\u503c\u5f02\u5e38", _.setLatestShare(r)
}, _.getShareInfo = function () {
    return JSON.stringify({
        i: za.store.getDistinctId() || "\u53d6\u503c\u5f02\u5e38",
        p: _.getCurrentPath(),
        d: query_share_depth,
        m: share_method
    })
}, _.detectOptionQuery = function (e) {
    if (!e || !_.isObject(e.query)) return {};
    var t, a, r, s, n = {};
    return n.query = _.extend({}, e.query), "string" == typeof n.query.scene && (t = n.query, a = ["utm_source", "utm_content", "utm_medium", "utm_campaign", "utm_term", "sa_utm"].concat(za.para.source_channel), r = new RegExp("(" + a.join("|") + ")%3D", "i"), 1 === (s = Object.keys(t)).length && "scene" === s[0] && r.test(t.scene)) && (n.scene = n.query.scene, delete n.query.scene), e.query.q && e.query.scancode_time && "101" === String(e.scene).slice(0, 3) && (n.q = String(n.query.q), delete n.query.q, delete n.query.scancode_time), n
}, _.getMixedQuery = function (e) {
    var t = _.detectOptionQuery(e), a = t.scene, r = t.q, s = t.query;
    for (var n in s) s[n] = _.decodeURIComponent(s[n]);
    return a && (a = -1 !== (a = _.decodeURIComponent(a)).indexOf("?") ? "?" + a.replace(/\?/g, "") : "?" + a, _.extend(s, _.getObjFromQuery(a))), r && _.extend(s, _.getObjFromQuery(_.decodeURIComponent(r))), s
}, _.setUtm = function (e, t) {
    var a = {}, r = _.getMixedQuery(e), s = _.getCustomUtmFromQuery(r, "$", "_", "$"),
        n = _.getCustomUtmFromQuery(r, "$latest_", "_latest_", "$latest_");
    return a.pre1 = s, a.pre2 = n, _.extend(t, s), a
}, _.setSfSource = function (e, t) {
    !_.isEmptyObject(e.query) && e.query._sfs && (t.$sf_source = e.query._sfs, za.registerApp({$latest_sf_source: t.$sf_source}))
}, _.setPageSfSource = function (e) {
    try {
        var t = getCurrentPages(), a = JSON.parse(JSON.stringify(t[t.length - 1].options));
        for (var r in a) a[r] = _.decodeURIComponent(a[r]);
        !_.isEmptyObject(a) && a._sfs && (e.$sf_source = a._sfs)
    } catch (e) {
        logger.info(e)
    }
};
try {
    var oldSetNavigationBarTitle = wx.setNavigationBarTitle;
    Object.defineProperty(wx, "setNavigationBarTitle", {
        get: function () {
            return function (e) {
                var t = getCurrentPages(), a = t[t.length - 1].route || "";
                e = _.isObject(e) ? e : {}, globalTitle[a] = e.title, oldSetNavigationBarTitle.call(this, e)
            }
        }
    })
} catch (e) {
    logger.info(e)
}

function mp_proxy(e, t, a) {
    var r = za.autoTrackCustom[a];
    if (e[t]) {
        var s = e[t];
        e[t] = function () {
            "onLaunch" === t && (this[za.para.name] = za), !za.para.autoTrackIsFirst || _.isObject(za.para.autoTrackIsFirst) && !za.para.autoTrackIsFirst[a] ? (s.apply(this, arguments), r.apply(this, arguments)) : (!0 === za.para.autoTrackIsFirst || _.isObject(za.para.autoTrackIsFirst) && za.para.autoTrackIsFirst[a]) && (r.apply(this, arguments), s.apply(this, arguments))
        }
    } else e[t] = function () {
        "onLaunch" === t && (this[za.para.name] = za), r.apply(this, arguments)
    }
}

function click_proxy(e, t) {
    var a = e[t];
    e[t] = function () {
        var e = a.apply(this, arguments), t = {}, r = "";
        if (_.isObject(arguments[0])) {
            _.isObject(arguments[0].event_prop) && (t = _.extend(t, arguments[0].event_prop));
            var s = arguments[0].currentTarget || {}, n = arguments[0].target || {};
            if (_.isObject(za.para.framework) && _.isObject(za.para.framework.taro) && !za.para.framework.taro.createApp && n.id && s.id && n.id !== s.id) return e;
            var i = s.dataset || {};
            r = arguments[0].type, t.$element_id = s.id, t.$element_type = i.type, t.$element_content = i.content, t.$element_name = i.name
        }
        return r && _.isClick(r) && (t.$url_path = _.getCurrentPath(), za.track("$MPClick", t)), e
    }
}

_.getPageTitle = function (e) {
    var t = "", a = e.route;
    try {
        if (__wxConfig) {
            var r = __wxConfig, s = r.page[a] || r.page[a + ".html"],
                n = {titleVal: r.global.window.navigationBarTitleText}, i = {titleVal: s.window.navigationBarTitleText};
            if (_.each(globalTitle, function (e, r) {
                if (r === a) return t = e
            }), 0 === t.length) {
                var o = _.extend(n, i);
                t = o.titleVal
            }
        }
    } catch (e) {
        logger.info(e)
    }
    return t
}, _.wxrequest = function (e) {
    var t = wx.request(e);
    setTimeout(function () {
        _.isObject(t) && _.isFunction(t.abort) && t.abort()
    }, za.para.datasend_timeout)
}, _.getAppId = function () {
    var e;
    if (wx.getAccountInfoSync && (e = wx.getAccountInfoSync()), _.isObject(e) && _.isObject(e.miniProgram)) return e.miniProgram.appId
}, _.validId = function (e) {
    return "string" != typeof e && "number" != typeof e || "" === e ? (logger.info("\u8f93\u5165 ID \u7c7b\u578b\u9519\u8bef"), !1) : "number" != typeof e || (e = String(e), /^\d+$/.test(e)) ? e : (logger.info("\u8f93\u5165 ID \u7c7b\u578b\u9519\u8bef"), !1)
}, _.info = {
    currentProps: {}, properties: {$lib: LIB_NAME, $lib_version: String(LIB_VERSION)}, getSystem: function () {
        var e = this.properties;

        function t() {
            wx.getSystemInfo({
                success: function (t) {
                    var a, r;
                    e.$manufacturer = t.brand, e.$model = t.model, e.$screen_width = Number(t.screenWidth), e.$screen_height = Number(t.screenHeight), e.$os = (a = t.platform, "ios" === (r = a.toLowerCase()) ? "iOS" : "android" === r ? "Android" : a), e.$os_version = t.system.indexOf(" ") > -1 ? t.system.split(" ")[1] : t.system
                }, complete: function () {
                    var t = (new Date).getTimezoneOffset(), a = _.getAppId();
                    _.isNumber(t) && (e.$timezone_offset = t), a && (e.$app_id = a), za.initialState.systemIsComplete = !0, za.initialState.checkIsComplete()
                }
            })
        }

        wx.getNetworkType({
            success: function (t) {
                e.$network_type = t.networkType
            }, complete: t
        })
    }
}, za._ = _, _.eventEmitter = function () {
    this.sub = []
}, _.eventEmitter.prototype = {
    add: function (e) {
        this.sub.push(e)
    }, emit: function (e, t) {
        this.sub.forEach(function (a) {
            a.on(e, t)
        })
    }
}, _.eventSub = function (e) {
    za.events.add(this), this._events = [], this.handle = e, this.ready = !1
}, _.eventSub.prototype = {
    on: function (e, t) {
        if (this.ready) {
            if (_.isFunction(this.handle)) try {
                this.handle(e, t)
            } catch (e) {
                logger.info(e)
            }
        } else this._events.push({event: e, data: t})
    }, isReady: function () {
        var e = this;
        e.ready = !0, e._events.forEach(function (t) {
            if (_.isFunction(e.handle)) try {
                e.handle(t.event, t.data)
            } catch (e) {
                logger.info(e)
            }
        })
    }
}, za.eventSub = _.eventSub, za.events = new _.eventEmitter, za.usePlugin = function (e, t) {
    "function" == typeof e.init && e.init(za, t)
}, za.prepareData = function (e, t) {
    if (current_scene && 1154 === current_scene) return !1;
    var a = {
        distinct_id: this.store.getDistinctId(),
        lib: {$lib: LIB_NAME, $lib_method: "code", $lib_version: String(LIB_VERSION)},
        properties: {}
    };
    _.extend(a, this.store.getUnionId(), e),
     _.isObject(e.properties) && !_.isEmptyObject(e.properties) 
     && _.extend(a.properties, e.properties), 
     e.type && "profile" === e.type.slice(0, 7) || (za.para.batch_send && (a._track_id = Number(String(Math.random()).slice(2, 5) + String(Math.random()).slice(2, 4) + String(Date.now()).slice(-4))),
      a.properties = _.extend({}, _.info.properties, za.store.getProps(), _.info.currentProps, a.properties), a.properties.$is_first_day = _.getIsFirstDay()), a.properties.$time && _.isDate(a.properties.$time) ? (a.time = 1 * a.properties.$time, delete a.properties.$time) : za.para.use_client_time && (a.time = 1 * new Date), _.parseSuperProperties(a.properties), _.searchObjDate(a), _.searchObjString(a), logger.info(a), za.events.emit("send", a), za.sendStrategy.send(a)
}, za.store = {
    storageInfo: null, getUUID: function () {
        return Date.now() + "-" + Math.floor(1e7 * Math.random()) + "-" + Math.random().toString(16).replace(".", "") + "-" + String(31242 * Math.random()).replace(".", "").slice(0, 8)
    }, getStorage: function () {
        return this.storageInfo ? this.storageInfo : (this.storageInfo = za._.getStorageSync("sensorsdata2015_wechat") || "", this.storageInfo)
    }, _state: {}, mem: {
        mdata: [], getLength: function () {
            return this.mdata.length
        }, add: function (e) {
            this.mdata.push(e)
        }, clear: function (e) {
            this.mdata.splice(0, e)
        }
    }, toState: function (e) {
        var t = null;
        _.isJSONString(e) ? (t = JSON.parse(e)).distinct_id ? this._state = t : this.set("distinct_id", this.getUUID()) : _.isObject(e) && (t = e).distinct_id ? this._state = t : this.set("distinct_id", this.getUUID())
    }, getFirstId: function () {
        return this._state._first_id || this._state.first_id
    }, getDistinctId: function () {
        return this._state._distinct_id || this._state.distinct_id
    }, getUnionId: function () {
        var e = {}, t = this._state._first_id || this._state.first_id,
            a = this._state._distinct_id || this._state.distinct_id;
        return t && a ? (e.login_id = a, e.anonymous_id = t) : e.anonymous_id = a, e
    }, getProps: function () {
        return this._state.props || {}
    }, setProps: function (e, t) {
        var a = this._state.props || {};
        t ? this.set("props", e) : (_.extend(a, e), this.set("props", a))
    }, set: function (e, t) {
        var a = {};
        for (var r in"string" == typeof e ? a[e] = t : "object" == typeof e && (a = e), this._state = this._state || {}, a) this._state[r] = a[r], "first_id" === r ? delete this._state._first_id : "distinct_id" === r && (delete this._state._distinct_id, za.events.emit("changeDistinctId"));
        this.save()
    }, change: function (e, t) {
        this._state["_" + e] = t
    }, save: function () {
        var e = JSON.parse(JSON.stringify(this._state));
        delete e._first_id, delete e._distinct_id, za._.setStorageSync("sensorsdata2015_wechat", e)
    }, init: function () {
        var e = this.getStorage();
        if (e) this.toState(e); else {
            is_first_launch = !0;
            var t = new Date, a = t.getTime();
            t.setHours(23), t.setMinutes(59), t.setSeconds(60), za.setOnceProfile({$first_visit_time: new Date}), this.set({
                distinct_id: this.getUUID(),
                first_visit_time: a,
                first_visit_day_time: t.getTime()
            })
        }
    }
}, za.setProfile = function (e, t) {
    za.prepareData({type: "profile_set", properties: e}, t)
}, za.setOnceProfile = function (e, t) {
    za.prepareData({type: "profile_set_once", properties: e}, t)
}, za.appendProfile = function (e, t) {
    if (!_.isObject(e)) return !1;
    _.each(e, function (t, a) {
        _.isString(t) ? e[a] = [t] : _.isArray(t) || (delete e[a], logger.info("appendProfile\u5c5e\u6027\u7684\u503c\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u6216\u8005\u6570\u7ec4"))
    }), za.prepareData({type: "profile_append", properties: e}, t)
}, za.incrementProfile = function (e, t) {
    if (!_.isObject(e)) return !1;
    var a = e;
    _.isString(e) && ((e = {})[a] = 1), za.prepareData({type: "profile_increment", properties: e}, t)
}, za.track = function (e, t, a) {
    this.prepareData({type: "track", event: e, properties: t}, a)
}, za.identify = function (e, t) {
    if (e = _.validId(e)) {
        var a = za.store.getFirstId();
        !0 === t ? a ? za.store.set("first_id", e) : za.store.set("distinct_id", e) : a ? za.store.change("first_id", e) : za.store.change("distinct_id", e)
    }
}, za.trackSignup = function (e, t, a, r) {
    var s = za.store.getFirstId() || za.store.getDistinctId();
    za.store.set("distinct_id", e), za.prepareData({
        original_id: s,
        distinct_id: e,
        type: "track_signup",
        event: t,
        properties: a
    }, r)
}, za.registerApp = function (e) {
    _.isObject(e) && !_.isEmptyObject(e) && (_.info.currentProps = _.extend(_.info.currentProps, e))
}, za.register = function (e) {
    _.isObject(e) && !_.isEmptyObject(e) && za.store.setProps(e)
}, za.clearAllRegister = function () {
    za.store.setProps({}, !0)
}, za.clearAllProps = function (e) {
    var t = za.store.getProps(), a = {};
    _.isArray(e) && (_.each(t, function (t, r) {
        _.include(e, r) || (a[r] = t)
    }), za.store.setProps(a, !0))
}, za.clearAppRegister = function (e) {
    _.isArray(e) && _.each(_.info.currentProps, function (t, a) {
        _.include(e, a) && delete _.info.currentProps[a]
    })
}, _.setLatestChannel = function (e) {
    _.isEmptyObject(e) || (function (e, t) {
        var a = !1;
        for (var r in t) e[t[r]] && (a = !0);
        return a
    }(e, latest_source_channel) && (za.clearAppRegister(latest_source_channel), za.clearAllProps(latest_source_channel)), za.para.is_persistent_save.utm ? za.register(e) : za.registerApp(e))
}, _.setLatestShare = function (e) {
    (e.$latest_share_depth || e.$latest_share_distinct_id || e.$latest_share_url_path || e.$latest_share_method) && (za.clearAppRegister(latest_share_info), za.clearAllProps(latest_share_info), za.para.is_persistent_save.share ? za.register(e) : za.registerApp(e))
}, za.login = function (e) {
    if (e = _.validId(e)) {
        var t = za.store.getFirstId(), a = za.store.getDistinctId();
        e !== a && (t ? za.trackSignup(e, "$SignUp") : (za.store.set("first_id", a), za.trackSignup(e, "$SignUp")))
    }
}, za.getAnonymousID = function () {
    if (!_.isEmptyObject(za.store._state)) return za.store._state._first_id || za.store._state.first_id || za.store._state._distinct_id || za.store._state.distinct_id;
    logger.info("\u8bf7\u5148\u521d\u59cb\u5316SDK")
}, za.logout = function (e) {
    var t = za.store.getFirstId();
    delete _.info.currentProps.$distinctIdType
    t ? (za.store.set("first_id", ""), !0 === e ? za.store.set("distinct_id", za.store.getUUID()) : za.store.set("distinct_id", t)) : logger.info("\u6ca1\u6709first_id\uff0clogout\u5931\u8d25")
}, za.getLocation = function () {
    wx.getSetting({
        success: function (e) {
            if (!e.authSetting["scope.userLocation"]) return !1;
            wx.getLocation({
                type: za.para.preset_properties.location.type, success: function (e) {
                    za.registerApp({$latitude: e.latitude * Math.pow(10, 6), $longitude: e.longitude * Math.pow(10, 6)})
                }, fail: function (e) {
                    console.log("\u83b7\u53d6\u4f4d\u7f6e\u5931\u8d25", e)
                }
            })
        }
    })
}, za.openid = {
    getRequest: function (e) {
        wx.login({
            success: function (t) {
                t.code && za.para.appid && za.para.openid_url ? _.wxrequest({
                    url: za.para.openid_url + "&code=" + t.code + "&appid=" + za.para.appid,
                    method: "GET",
                    complete: function (t) {
                        _.isObject(t) && _.isObject(t.data) && t.data.openid ? e(t.data.openid) : e()
                    }
                }) : e()
            }
        })
    }, getWXStorage: function () {
        var e = za.store.getStorage();
        if (e && _.isObject(e)) return e.openid
    }, getOpenid: function (e) {
        if (!za.para.appid) return e(), !1;
        var t = this.getWXStorage();
        t ? e(t) : this.getRequest(e)
    }
}, za.initial = function () {
    this._.info.getSystem(), this.store.init()
}, za.init = function (e) {
    if (!0 === this.hasInit) return !1;
    this.hasInit = !0, za.setPara(e), za.para.batch_send && (wx.getStorage({
        key: "sensors_mp_prepare_data",
        complete: function (e) {
            var t = e.data && _.isArray(e.data) ? e.data : [];
            za.store.mem.mdata = t.concat(za.store.mem.mdata), za.sendStrategy.syncStorage = !0
        }
    }), za.sendStrategy.batchInterval()), za.initialState.storeIsComplete = !0, za.initialState.checkIsComplete()
}, za.getPresetProperties = function () {
    if (_.info && _.info.properties && _.info.properties.$lib) {
        var e = {};
        _.each(_.info.currentProps, function (t, a) {
            0 === a.indexOf("$") && (e[a] = t)
        });
        var t = _.extend(e, {
            $url_path: _.getCurrentPath(),
            $is_first_day: _.getIsFirstDay()
        }, _.info.properties, za.store.getProps());
        return delete t.$lib, t
    }
    return {}
}, _.autoExeQueue = function () {
    return {
        items: [], enqueue: function (e) {
            this.items.push(e), this.start()
        }, dequeue: function () {
            return this.items.shift()
        }, getCurrentItem: function () {
            return this.items[0]
        }, isRun: !1, start: function () {
            this.items.length > 0 && !this.isRun && (this.isRun = !0, this.getCurrentItem().start())
        }, close: function () {
            this.dequeue(), this.isRun = !1, this.start()
        }
    }
}, za.requestQueue = function (e) {
    this.url = e.url
}, za.requestQueue.prototype.isEnd = function () {
    this.received || (this.received = !0, this.close())
}, za.requestQueue.prototype.start = function () {
    var e = this;
    setTimeout(function () {
        e.isEnd()
    }, za.para.send_timeout), _.wxrequest({
        url: this.url, method: "GET", complete: function () {
            e.isEnd()
        }
    })
}, za.dataQueue = _.autoExeQueue(), za.sendStrategy = {
    dataHasSend: !0, dataHasChange: !1, syncStorage: !1, failTime: 0, onAppHide: function () {
        za.para.batch_send && this.batchSend()
    }, send: function (e) {
        if (!za.para.server_url) return !1;
        if (za.para.batch_send) {
            if (this.dataHasChange = !0, za.store.mem.getLength() >= 300) return logger.info("\u6570\u636e\u91cf\u5b58\u50a8\u8fc7\u5927\uff0c\u6709\u5f02\u5e38"), !1;
            za.store.mem.add(e), za.store.mem.getLength() >= za.para.batch_send.max_length && this.batchSend()
        } else this.queueSend(e)
    }, queueSend: function (e) {
        if (e && e.properties && null == e.properties.$distinctIdType) {
            Object.assign(e.properties, {$distinctIdType: _.info.currentProps.$distinctIdType})
        }
        e = JSON.stringify(e), e = -1 !== za.para.server_url.indexOf("?") ? za.para.server_url + "&data=" + encodeURIComponent(_.base64Encode(e)) : za.para.server_url + "?data=" + encodeURIComponent(_.base64Encode(e));
        var t = new za.requestQueue({url: e});
        t.close = function () {
            za.dataQueue.close()
        }, za.dataQueue.enqueue(t)
    }, wxrequest: function (e) {
        if (_.isArray(e.data) && e.data.length > 0) {
            var t = Date.now();
            e.data.forEach(function (e) {
                e._flush_time = t
                if (e.properties && null == e.properties.$distinctIdType) {
					Object.assign(e.properties, {$distinctIdType: _.info.currentProps.$distinctIdType})
				}
            }), e.data = JSON.stringify(e.data), _.wxrequest({
                url: za.para.server_url,
                method: "POST",
                dataType: "text",
                data: "data_list=" + encodeURIComponent(_.base64Encode(e.data)),
                success: function () {
                    e.success(e.len)
                },
                fail: function () {
                    e.fail()
                }
            })
        } else e.success(e.len)
    }, batchSend: function () {
        if (this.dataHasSend) {
            var e = za.store.mem.mdata, t = e.length;
            e.forEach((v) => {
				if (v && v.properties && null == v.properties.$distinctIdType) {
					console.log('--request interceptors--', v);
					Object.assign(v.properties, {$distinctIdType: _.info.currentProps.$distinctIdType})
				}
			});
            t > 0 && (this.dataHasSend = !1, this.wxrequest({
                data: e,
                len: t,
                success: this.batchRemove.bind(this),
                fail: this.sendFail.bind(this)
            }))
        }
    }, sendFail: function () {
        this.dataHasSend = !0, this.failTime++
    }, batchRemove: function (e) {
        za.store.mem.clear(e), this.dataHasSend = !0, this.dataHasChange = !0, this.batchWrite(), this.failTime = 0
    }, is_first_batch_write: !0, batchWrite: function () {
        var e = this;
        this.dataHasChange && (this.is_first_batch_write && (this.is_first_batch_write = !1, setTimeout(function () {
            e.batchSend()
        }, 1e3)), this.dataHasChange = !1, this.syncStorage && za._.setStorageSync("sensors_mp_prepare_data", za.store.mem.mdata))
    }, batchInterval: function () {
        var e = this;
        !function t() {
            setTimeout(function () {
                e.batchWrite(), t()
            }, 500)
        }(), function t() {
            setTimeout(function () {
                e.batchSend(), t()
            }, za.para.batch_send.send_timeout * Math.pow(2, e.failTime))
        }()
    }
}, za.setOpenid = function (e, t) {
    za.store.set("openid", e), t ? za.store.set("distinct_id", e) : za.identify(e, !0)
}, za.initWithOpenid = function (e, t) {
    (e = e || {}).appid && (za.para.appid = e.appid), za.openid.getOpenid(function (a) {
        a && za.setOpenid(a, e.isCoverLogin), t && _.isFunction(t) && t(a), za.init(e)
    })
}, _.each(["setProfile", "setOnceProfile", "track", "quick", "incrementProfile", "appendProfile", "login", "logout"], function (e) {
    var t = za[e];
    za[e] = function () {
        za.initialState.isComplete ? t.apply(za, arguments) : za.initialState.queue.push([e, arguments])
    }
}), _.setQuery = function (e, t) {
    if (e && _.isObject(e) && !_.isEmptyObject(e)) {
        var a = [];
        return _.each(e, function (e, r) {
            "q" === r && _.isString(e) && 0 === e.indexOf("http") || "scene" === r || (t ? a.push(r + "=" + e) : a.push(r + "=" + _.decodeURIComponent(e)))
        }), a.join("&")
    }
    return ""
}, _.getUtmFromPage = function () {
    var e = {};
    try {
        var t = getCurrentPages(), a = JSON.parse(JSON.stringify(t[t.length - 1].options));
        for (var r in a) a[r] = _.decodeURIComponent(a[r]);
        e = _.getCustomUtmFromQuery(a, "$", "_", "$")
    } catch (e) {
        logger.info(e)
    }
    return e
}, za.autoTrackCustom = {
    trackCustom: function (e, t, a) {
        var r = za.para.autoTrack[e], s = "";
        za.para.autoTrack && r && ("function" == typeof r ? (s = r(), _.isObject(s) && _.extend(t, s)) : _.isObject(r) && (_.extend(t, r), za.para.autoTrack[e] = !0), za.track(a, t))
    }, appLaunch: function (e, t) {
        "object" != typeof this || this.trackCustom || (this[za.para.name] = za);
        var a = {};
        e && e.scene ? (current_scene = e.scene, a.$scene = _.getMPScene(e.scene)) : a.$scene = "\u672a\u53d6\u5230\u503c", e && e.scene && 1010 === e.scene && e.query && e.query.sampshare && delete e.query.sampshare, e && e.path && (a.$url_path = _.getPath(e.path), !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: a.$url_path})), _.setShareInfo(e, a);
        var r = _.setUtm(e, a);
        is_first_launch ? (a.$is_first_time = !0, _.isEmptyObject(r.pre1) || za.setOnceProfile(r.pre1)) : a.$is_first_time = !1, _.setLatestChannel(r.pre2), _.setSfSource(e, a), za.registerApp({$latest_scene: a.$scene}), a.$url_query = _.setQuery(e.query), t ? (a = _.extend(a, t), za.track("$MPLaunch", a)) : za.para.autoTrack && za.para.autoTrack.appLaunch && za.autoTrackCustom.trackCustom("appLaunch", a, "$MPLaunch")
    }, appShow: function (e, t) {
        var a = {};
        mpshow_time = (new Date).getTime(), e && e.scene ? (current_scene = e.scene, a.$scene = _.getMPScene(e.scene)) : a.$scene = "\u672a\u53d6\u5230\u503c", e && e.scene && 1010 === e.scene && e.query && e.query.sampshare && delete e.query.sampshare, e && e.path && (a.$url_path = _.getPath(e.path), !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: a.$url_path})), !_.isObject(za.para.preset_properties.location) || "wgs84" !== za.para.preset_properties.location.type && "gcj02" !== za.para.preset_properties.location.type || za.getLocation(), _.setShareInfo(e, a);
        var r = _.setUtm(e, a);
        _.setLatestChannel(r.pre2), _.setSfSource(e, a), za.registerApp({$latest_scene: a.$scene}), a.$url_query = _.setQuery(e.query), t ? (a = _.extend(a, t), za.track("$MPShow", a)) : za.para.autoTrack && za.para.autoTrack.appShow && za.autoTrackCustom.trackCustom("appShow", a, "$MPShow")
    }, appHide: function (e) {
        var t = (new Date).getTime(), a = {};
        a.$url_path = _.getCurrentPath(), mpshow_time && t - mpshow_time > 0 && (t - mpshow_time) / 36e5 < 24 && (a.event_duration = (t - mpshow_time) / 1e3), e ? (a = _.extend(a, e), za.track("$MPHide", a)) : za.para.autoTrack && za.para.autoTrack.appHide && za.autoTrackCustom.trackCustom("appHide", a, "$MPHide"), za.sendStrategy.onAppHide()
    }, pageLoad: function (e) {
        current_scene && 1010 === current_scene && e && e.sampshare && delete e.sampshare, e && _.isObject(e) && (this.sensors_mp_url_query = _.setQuery(e), this.sensors_mp_encode_url_query = _.setQuery(e, !0))
    }, pageShow: function () {
        var e = {}, t = _.getCurrentPath(), a = _.getPageTitle(this);
        e.$referrer = sa_referrer, e.$url_path = t, za.status.last_referrer = sa_referrer, e.$url_query = this.sensors_mp_url_query ? this.sensors_mp_url_query : "", e = _.extend(e, _.getUtmFromPage()), _.setPageSfSource(e), a && (e.$title = a), za.para.onshow ? za.para.onshow(za, t, this) : _.isObject(za.para.autotrack_exclude_page) && _.isArray(za.para.autotrack_exclude_page.pageShow) && -1 !== za.para.autotrack_exclude_page.pageShow.indexOf(t) || za.autoTrackCustom.trackCustom("pageShow", e, "$MPViewScreen"), !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: t}), sa_referrer = t, za.status.referrer = t
    }, pageShare: function (e) {
        var t = e.onShareAppMessage;
        e.onShareAppMessage = function () {
            share_method = "\u8f6c\u53d1\u6d88\u606f\u5361\u7247";
            var e = t.apply(this, arguments);
            return za.para.autoTrack && za.para.autoTrack.pageShare && za.autoTrackCustom.trackCustom("pageShare", {
                $url_path: _.getCurrentPath(),
                $share_depth: query_share_depth,
                $share_method: share_method
            }, "$MPShare"), za.para.allow_amend_share_path && ("object" != typeof e && ((e = {}).path = _.getCurrentUrl(this)), "object" != typeof e || void 0 !== e.path && "" !== e.path || (e.path = _.getCurrentUrl(this)), "object" == typeof e && "string" == typeof e.path && (-1 === e.path.indexOf("?") ? e.path = e.path + "?" : "&" !== e.path.slice(-1) && (e.path = e.path + "&")), e.path = e.path + "sampshare=" + encodeURIComponent(_.getShareInfo())), e
        }
    }, pageShareTimeline: function (e) {
        var t = e.onShareTimeline;
        e.onShareTimeline = function () {
            share_method = "\u670b\u53cb\u5708\u5206\u4eab";
            var e = t.apply(this, arguments);
            return za.para.autoTrack && za.para.autoTrack.pageShare && za.autoTrackCustom.trackCustom("pageShare", {
                $url_path: _.getCurrentPath(),
                $share_depth: query_share_depth,
                $share_method: share_method
            }, "$MPShare"), za.para.allow_amend_share_path && ("object" != typeof e && (e = {}), "object" == typeof e && void 0 === e.query && (e.query = ""), "object" == typeof e && "string" == typeof e.query && "" !== e.query && "&" !== e.query.slice(-1) && (e.query = e.query + "&"), e.query = e.query + "sampshare=" + encodeURIComponent(_.getShareInfo())), e
        }
    }, pageAddFavorites: function () {
        var e = {};
        e.$url_path = _.getCurrentPath(), za.para.autoTrack && za.para.autoTrack.mpFavorite && za.autoTrackCustom.trackCustom("mpFavorite", e, "$MPAddFavorites")
    }
}, za.quick = function () {
    var e = arguments[0], t = arguments[1], a = arguments[2], r = _.isObject(a) ? a : {};
    if ("getAnonymousID" === e) {
        if (!_.isEmptyObject(za.store._state)) return za.store._state._first_id || za.store._state.first_id || za.store._state._distinct_id || za.store._state.distinct_id;
        logger.info("\u8bf7\u5148\u521d\u59cb\u5316SDK")
    } else "appLaunch" === e || "appShow" === e ? t ? za.autoTrackCustom[e](t, r) : logger.info("App\u7684launch\u548cshow\uff0c\u5728sensors.quick\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5fc5\u987b\u4f20\u5165App\u7684options\u53c2\u6570") : "appHide" === e && (r = _.isObject(t) ? t : {}, za.autoTrackCustom[e](r))
}, za.appLaunch = function (e, t) {
    var a = {};
    _.isObject(t) && (a = _.extend(a, t)), e && e.scene ? (current_scene = e.scene, a.$scene = _.getMPScene(e.scene)) : a.$scene = "\u672a\u53d6\u5230\u503c", e && e.scene && 1010 === e.scene && e.query && e.query.sampshare && delete e.query.sampshare, e && e.path && (a.$url_path = _.getPath(e.path), !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: a.$url_path})), _.setShareInfo(e, a);
    var r = _.setUtm(e, a);
    is_first_launch ? (a.$is_first_time = !0, _.isEmptyObject(r.pre1) || za.setOnceProfile(r.pre1)) : a.$is_first_time = !1, _.setLatestChannel(r.pre2), _.setSfSource(e, a), za.registerApp({$latest_scene: a.$scene}), a.$url_query = _.setQuery(e.query), za.track("$MPLaunch", a)
}, za.appShow = function (e, t) {
    var a = {};
    _.isObject(t) && (a = _.extend(a, t)), mpshow_time = (new Date).getTime(), e && e.scene ? (current_scene = e.scene, a.$scene = _.getMPScene(e.scene)) : a.$scene = "\u672a\u53d6\u5230\u503c", e && e.scene && 1010 === e.scene && e.query && e.query.sampshare && delete e.query.sampshare, e && e.path && (a.$url_path = _.getPath(e.path), !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: a.$url_path})), !_.isObject(za.para.preset_properties.location) || "wgs84" !== za.para.preset_properties.location.type && "gcj02" !== za.para.preset_properties.location.type || za.getLocation(), _.setShareInfo(e, a);
    var r = _.setUtm(e, a);
    _.setLatestChannel(r.pre2), _.setSfSource(e, a), za.registerApp({$latest_scene: a.$scene}), a.$url_query = _.setQuery(e.query), za.track("$MPShow", a)
}, za.appHide = function (e) {
    var t = (new Date).getTime(), a = {};
    _.isObject(e) && (a = _.extend(a, e)), a.$url_path = _.getCurrentPath(), mpshow_time && t - mpshow_time > 0 && (t - mpshow_time) / 36e5 < 24 && (a.event_duration = (t - mpshow_time) / 1e3), za.track("$MPHide", a), za.sendStrategy.onAppHide()
}, za.pageShow = function (e) {
    var t = {}, a = _.getCurrentPath();
    _.isObject(e) && (t = _.extend(t, e));
    var r = {};
    try {
        var s = getCurrentPages();
        r = s[s.length - 1]
    } catch (e) {
        logger.info(e)
    }
    !0 === za.para.preset_properties.url_path && za.registerApp({$url_path: a}), t.$referrer = sa_referrer, t.$url_path = a, za.status.last_referrer = sa_referrer, t.$url_query = r.sensors_mp_url_query ? r.sensors_mp_url_query : "", t = _.extend(t, _.getUtmFromPage()), _.setPageSfSource(t), za.track("$MPViewScreen", t), sa_referrer = a, za.status.referrer = a
};
var oldApp = App;
App = function (e) {
    e[za.para.name] = za, oldApp.apply(this, arguments)
}, wx.onAppShow(function (e) {
    if (!za.para.launched) {
        var t = wx.getLaunchOptionsSync() || {};
        za.autoTrackCustom.appLaunch(t), za.para.launched = !0
    }
    za.autoTrackCustom.appShow(e)
}), wx.onAppHide(function () {
    za.autoTrackCustom.appHide()
});
var oldPage = Page;
Page = function (e) {
    var t = za.para.autoTrack && za.para.autoTrack.mpClick && _.getMethods(e);
    if (t) for (var a = 0, r = t.length; a < r; a++) click_proxy(e, t[a]);
    mp_proxy(e, "onLoad", "pageLoad"), mp_proxy(e, "onShow", "pageShow"), mp_proxy(e, "onAddToFavorites", "pageAddFavorites"), "function" == typeof e.onShareAppMessage && za.autoTrackCustom.pageShare(e), "function" == typeof e.onShareTimeline && za.autoTrackCustom.pageShareTimeline(e), oldPage.apply(this, arguments)
};
var oldComponent = Component;
Component = function (e) {
    try {
        var t = za.para.autoTrack && za.para.autoTrack.mpClick && _.getMethods(e.methods);
        if (t) for (var a = 0, r = t.length; a < r; a++) click_proxy(e.methods, t[a]);
        mp_proxy(e.methods, "onLoad", "pageLoad"), mp_proxy(e.methods, "onShow", "pageShow"), mp_proxy(e.methods, "onAddToFavorites", "pageAddFavorites"), "function" == typeof e.methods.onShareAppMessage && za.autoTrackCustom.pageShare(e.methods), "function" == typeof e.methods.onShareTimeline && za.autoTrackCustom.pageShareTimeline(e.methods), oldComponent.apply(this, arguments)
    } catch (e) {
        oldComponent.apply(this, arguments)
    }
}, za.initial(), module.exports = za;
